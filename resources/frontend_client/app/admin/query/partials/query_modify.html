<div class="wrapper">
    <form id="query_form" novalidate>
        <input type="hidden" name="q" value="{{queryResultData.uuid}}" ng-if="queryResultData"/>

        <div class="py2">
            <h2>Modify Query</h2>

            <div>
                <label for="id_name">Name:</label>
                <input class="input full" id="id_name" type="text" ng-model="query.name"/>
            </div>

            <div class="py1">
                <label for="id_sql">SQL:</label>
                <cv-ace-sql-editor sql="query.details.sql" database="query.database.id" onLoad="onEditorLoaded"></cv-ace-sql-editor>
            </div>

            <div class="py1 clearfix">
                <div class="float-right">
                    <label>Permissions:</label>
                    <select class="input" ng-model="query.public_perms" ng-options="perm.id as perm.name for perm in form_input['permissions']">
                    </select>
                </div>

                <div class="">
                    <label>Database:</label>
                    <select class="input" ng-model="query.database.id" ng-options="db.id as db.name for db in form_input['databases']">
                    </select>

                    <label class="mx2">
                        Connection Timezone:
                        <select class="input" ng-model="query.details.timezone" ng-options="tz for tz in form_input['timezones']">
                            <option value="">----- (database tz)</option>
                        </select>
                    </label>

                </div>
            </div>
        </div>

        <div class="">
            <div class="float-right">
                <input class="Button" type="button" value="Clone Query" ng-if="can_read" ng-click="cloneQuery(query.id)"/>
                <a class="Button" cv-org-href="/admin/query/{{query.id}}">Done Editing</a>
            </div>

            <input class="Button Button--primary" type="button" value="Save and Execute" ng-click="saveAndExecute(query)"/>
            <a class="Button" href="/api/result/{{queryResult.id}}/csv" target="_self" ng-if="queryResultData">Download Results</a>

        </div>
    </form>

    <div ng-include="'/app/admin/query/partials/query_detail_results.html?cb=4'"></div>

    <div ng-include="'/app/admin/query/partials/query_detail_recentexec.html?cb=2'"></div>

</div>
