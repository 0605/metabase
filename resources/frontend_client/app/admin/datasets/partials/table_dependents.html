
<div class="wrapper">
  <div class="py1 border-bottom">
      <h2>Dependent Queries</h2>
  </div>

  <div class="List-filters List-section clearfix">
      <div class="List-filterCategories float-left">
          <span class="List-filterLabel float-left">Filter:</span>
          <div class="Button-group">
              <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'all' }" ng-click="filter('all')">all</a>
              <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'mine' }" ng-click="filter('mine')">mine</a>
          </div>
      </div>
      <div class="mx3 float-left">
          <input class="input" type="text" ng-model="searchFilter" placeholder="Search queries ...">
      </div>
      <div class="float-right">
          <span>Sort by:</span>
          <select ng-init="sortMode = 'name'" ng-model="sortMode" ng-change="sort()">
            <option value="name">Name (default)</option>
            <option value="owner">Owner</option>
            <option value="db">Database</option>
            <option value="date">Last Updated</option>
          </select>
      </div>
  </div>

  <div class="TableWrapper my2">
    <table class="Table">
      <thead>
        <th>Name</th>
        <th>Owner</th>
        <th>Visibility</th>
        <th>Database</th>
        <th>Last Updated</th>
        <th>Details</th>
      </thead>

      <tfoot>
        <tr ng-if="!dependents.queries">
          <td colspan="7" style="text-align:center;"><h3>Loading ...</h3></td>
        </tr>
      </tfoot>

      <tbody>
        <tr ng-repeat="query in dependents.queries | filter:searchFilter">
          <td><a cv-org-href="/admin/query/{{query.id}}">{{query.name}}</a></td>
          <td>{{query.creator.common_name}}</td>
          <td style="white-space:nowrap;">
            <a cv-org-href="#" ng-if="query.can_write" editable-select="query.public_perms" onaftersave="inlineSave(query, $index)" e-ng-options="perm.id as perm.name for perm in utils.perms">{{utils.permName(query.public_perms)}}</a>
            <span ng-if="!query.can_write">{{utils.permName(query.public_perms)}}</span>
          </td>
          <td>{{query.database.name}}</td>
          <td style="white-space:nowrap;">{{query.updated_at | date : 'MMMM d, y, hh:mm a'}}</td>
          <td width="40%">{{query.details.sql | limitTo : 200}}</td>
          
        </tr>
      </tbody>
    </table>
  </div>

  <div class="py1 border-bottom">
      <h2>Cards</h2>
              <div class="List">
            <div class="List-filters List-section clearfix">
                <div class="List-filterCategories float-left">
                    <span class="List-filterLabel float-left">Filter:</span>
                    <div class="Button-group">
                        <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'all' }" ng-click="filter('all')">all</a>
                        <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'mine' }" ng-click="filter('mine')">mine</a>
                        <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'fav' }" ng-click="filter('fav')">fav</a>
                    </div>
                </div>
                <div class="float-right">
                    <input class="input" type="text" ng-model="searchFilter" placeholder="Search for a card...">
                </div>
            </div>

            <ul>
                <li class="List-item List-section" ng-repeat="card in dependents.cards | filter:searchFilter ">
                    <div class="float-right my2">
                        <span class="List-timeStamp">{{card.updated_at | date : 'MMM d, y, hh:mm a'}}</span>
                    </div>
                    <h3>
                        <a class="text-normal link" target="_blank" cv-org-href="/card/{{card.id}}">{{card.name}}</a>
                    </h3>
                    <h5>Created by: {{card.creator.common_name}}</h5>
                </li>
            </ul>
        </div>
  </div>


  <div class="py1 border-bottom">
      <h2>Dashboards</h2>
              <div class="List">
            <div class="List-filters List-section clearfix">
                <div class="float-left">
                    <span class="List-filterLabel float-left">Filter:</span>
                    <div class="Button-group">
                        <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'all' }" ng-click="filter('all')">all</a>
                        <a class="Button" ng-class="{ 'Button--selected' : filterMode == 'mine' }" ng-click="filter('mine')">mine</a>
                    </div>
                </div>
                <div class="float-right">
                    <input class="input" type="text" ng-model="searchFilter" placeholder="Search...">
                </div>
            </div>
            <ul>
                <li class="List-item List-section" ng-repeat="dash in dependents.dashboards | filter:searchFilter">
                    <div class="float-right my2">
                        <span class="List-timeStamp mx3 inline-block">{{dash.updated_at | date : 'MMM d, y, hh:mm a'}}</span>
                    </div>
                    <h3>
                        <a class="link text-normal" target="_blank" cv-org-href="/dash/{{dash.id}}">{{dash.name}}</a>
                    </h3>
                    <p>{{dash.description}}</p>
                    <span class="text-grey-3">Created by: {{dash.creator.common_name}}</span>
                </li>
            </ul>
        </div>


  </div>


</div>
