
<div class="wrapper">
    <form class="Form" novalidate>
        <div class="py2 border-bottom">
            <h2>Job Details</h2>

            <div class="py1 float-right">
              <div>
                <label for="id_mode">Mode:</label>
                <select class="block" id="id_mode" ng-init="job.mode = utils.etljob_modes[0].id" ng-model="job.mode" ng-options="mode.id as mode.name for mode in utils.etljob_modes">
                </select>
              </div>

              <div class="py2">
                <label for="id_perms">Permissions:</label>
                <select class="block" id="id_perms" ng-init="job.public_perms = utils.perms[2].id" ng-model="job.public_perms" ng-options="perm.id as perm.name for perm in utils.perms">
                </select>
              </div>
            </div>

            <div class="py1">
                <label for="id_name">Job Name:</label>
                <input class="input block" id="id_name" size="80" maxlength="255" type="text" ng-model="job.name"/>
            </div>

            <div class="py1 clearfix">
                <label for="id_database">Database:</label>
                <select class="block" id="id_database" ng-model="job.database" ng-options="dm.id as dm.name for dm in form_input['databases']">
                </select>
            </div>

            <div class="py1">
                <label for="id_sql_table">Output SQL Table:</label>
                <input class="input block" id="id_sql_table" size="80" maxlength="255" type="text" ng-model="job.details.table_name"/>
            </div>

            <div class="">
                <label>Connection Timezone:</label>
                <select class="block" ng-model="job.details.timezone" ng-options="tz for tz in form_input['timezones']">
                    <option value="">----- (database tz)</option>
                </select>
            </div>
        </div>

        <div class="py2">
            <h2>Job Steps</h2>

            <div class="py1" ng-repeat="step in job.details.steps">
              <label for="id_sql">Step #{{$index}}:</label>
              <textarea class="input block full" id="id_sql" rows="6" ng-model="step.sql.query"></textarea>
            </div>

            <p>
              Hint: You can refer to the output of any given step as a SQL Table by using the ${table_&lt;step_number&gt;} syntax.  Ex: ${table_0} refers to the output of the first step of your job.
            </p>

            <div class="py1">
              <a class="Button" ng-click="addStep()">Add Step</a>
              <a class="Button" ng-click="removeStep()" delete-confirm>Remove Step</a>
            </div>
        </div>

        <div class="my1 py2 border-top">
          <div class="float-right">
            <input class="Button" type="button" value="Execute Now" ng-if="job.id" ng-click="executeJob(job.id)"/>
          </div>

          <input class="Button Button--primary" type="button" value="Save" ng-click="save(job)"/>

          <div class="inline-block" ng-cloak>
              <span class="px2 text-success" ng-if="success_message" cv-delayed-call="clearStatus()">{{success_message}}</span>
              <span class="px2 text-error" ng-if="error_message" cv-delayed-call="clearStatus()">{{error_message}}</span>

              <alert class="alert" ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" ng-animate=" 'animate' " cv-delayed-call="closeAlert($index)">{{alert.msg}}</alert>
          </div>
        </div>
    </form>
</div>
